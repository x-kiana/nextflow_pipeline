process.executor = 'slurm'
profiles {
   gpcc {
      params {
          // resources
          java = '/mnt/common/Precision/NextFlow/June2023/jdk-20.0.1/bin/java'
          refgenome = '/mnt/common/DATABASES/REFERENCES/GRCh38/GENOME/GRCh38-lite.fa'
          exomiser = 'exomiser-cli-13.1.0.jar'
          exomiserDir = '/mnt/common/Precision/Exomiser/exomiser-cli-13.1.0/' 
          deepvariantSif = '/mnt/common/Precision/DeepVariant/deepvariant_1.4.0.sif'
          genomeConda = 'scripts/GenomeAnalysisGAM.yml'
          picardConda = 'scripts/BwaGenomeAnalysis.yml'
      
          // paths
          wd = '/mnt/common/Precision/NextFlow/kiana_nextflow_pipeline/nextflow_pipeline'
          exomiserConfig = "/mnt/common/Precision/NextFlow/kiana_nextflow_pipeline/nextflow_pipeline/scripts/Case6_Exomiser.yml"
          exomiserTestConfig = "/mnt/common/Precision/NextFlow/kiana_nextflow_pipeline/nextflow_pipeline/scripts/Exomiser_Template.yml"
          sample_sheet = '/mnt/common/Precision/NextFlow/kiana_nextflow_pipeline/nextflow_pipeline/CaseSixSampleSheet.tsv'
          test_sample_sheet = '/mnt/common/Precision/NextFlow/kiana_nextflow_pipeline/nextflow_pipeline/Case6Updated.tsv'
      
          // misc
          region = 'X:153,500,000-154,000,000'
          // WGS or WES
          seq_type = 'WGS'
      }
      process.executor = 'slurm'
      process.queue = 'defq'
      dag.overwrite = true
      process.cache = 'lenient'
      process.shell = ['/bin/bash','-e']
      executor { queueSize = 60 }
      process {
          withName:FASTQTOSAM {
               conda = params.genomeConda
               publishDir = 'results'
	       cpus = 8
	       memory = 64G 
          }
          withName:SAMTOBAM {
               conda = params.genomeConda
	       publishDir = 'results'
	       cpus = 8
	       memory = 64G
          }
          withName:SORTEDBAM {
               conda = params.genomeCondaEnv
	       publishDir = 'results'
	       cpus = 8
	       memory = 64G
          }
          withName:INDEXEDBAM {
               conda = params.genomeCondaEnv
	       publishDir = 'results'
	       cpus = 8
               memory = 64G
          } 
          withName:DEEPVARIANT {
               container = params.deepvariantSif 
               publishDir = 'results'
               cpus = 8
               memory = 64G
           }
           withName:GLNEXUS2 {
               conda = params.genomeCondaEnv
               publishDir = 'results'
               cpus = 8
               memory = 64G
           }
           withName:GLNEXUS {
               container = params.glnexusSif     
               publishDir = 'results'
               cpus = 8
               memory = 64G
           }
           withName:EXOMISER {
               publishDir = 'results'
               cpus = 8
               memory = 64G
           }
           withName:DUPREMOVED {
               publishDir = 'results'
               conda = params.picardCondaEnv
               cpus = 8
               memory = 64G
           }
       }
   }
   sockeye {
      process.executor = 'slurm'
      dag.overwrite = true
      process.cache = 'lenient'
      process.shell = ['/bin/bash','-e']
      executor { queueSize = 60 }
      process.beforeScript = 'source /project/st-sturvey-1/PrecisionHealthVirtualEnvironment/Workflows/nextflow_pipeline/miniconda3/etc/profile.d/conda.sh'
      beforeScript = 'source /project/st-sturvey-1/PrecisionHealthVirtualEnvironment/Workflows/nextflow_pipeline/miniconda3/etc/profile.d/conda.sh'
      params {
          // resources
          java = '/project/st-sturvey-1/PrecisionHealthVirtualEnvironment/Workflows/nextflow_pipeline/java/jdk-20.0.2/bin/java'
          refgenome = '/project/st-sturvey-1/PrecisionHealthVirtualEnvironment/Databases/References/GRCh38/Genome/Ensembl/GRCh38-lite.fa'
          exomiser = 'exomiser-cli-13.2.0.jar'
          exomiserDir = '/project/st-sturvey-1/PrecisionHealthVirtualEnvironment/Software/Exomiser/exomiser-cli-13.2.0/' 
          deepvariantSif = '/project/st-sturvey-1/PrecisionHealthVirtualEnvironment/Software/DeepVariant/deepvariant_1.4.0.sif'
          glnexusSif = '/project/st-sturvey-1/PrecisionHealthVirtualEnvironment/Software/GLNexus/glnexus_v1.4.3.sif'
          genomeConda = 'scripts/GenomeAnalysisGAM.yml'
          genomeCondaEnv = '/project/st-sturvey-1/PrecisionHealthVirtualEnvironment/Workflows/nextflow_pipeline/miniconda3/envs/GenomeAnalysisGAM'
          picardConda = 'scripts/BwaGenomeAnalysis.yml'
          picardCondaEnv = '/project/st-sturvey-1/PrecisionHealthVirtualEnvironment/Workflows/nextflow_pipeline/miniconda3/envs/BwaGenomeAnalysis'
      
          // paths
          //wd = '/scratch/st-sturvey-3/kiana_test'
          wd = '/scratch/st-sturvey-1/Sandbox/nextflow_pipeline/'
          exomiserConfig = "/scratch/st-sturvey-1/Sandbox/kiana_nextflow_pipeline/nextflow_pipeline/scripts/Case6_Exomiser.yml"
          exomiserTestConfig = "/scratch/st-sturvey-1/Sandbox/kiana_nextflow_pipeline/nextflow_pipeline/scripts/Exomiser_Template.yml"
          sample_sheet = '/scratch/st-sturvey-1/Sandbox/nextflow_pipeline/Case6Test.tsv' 
          ped_script = '/scratch/st-sturvey-1/Sandbox/nextflow_pipeline/create_ped.awk'
      
          // misc
          region = 'X:153,500,000-154,000,000'
	  // WES or WGS
          seq_type = 'WGS'
      }
	process {
	   withName:FASTQTOSAM {
                process.clusterOptions =  '--account=st-sturvey-1 --nodes=1'
	        conda = params.genomeCondaEnv
		publishDir = 'results'
		cpus = 8
		memory = 64G 
	   }
	   withName:SAMTOBAM {
                process.clusterOptions =  '--account=st-sturvey-1 --nodes=1'
	        conda = params.genomeCondaEnv
		publishDir = 'results'
		cpus = 8
		memory = 64G
	   }
	   withName:SORTEDBAM {
                process.clusterOptions =  '--account=st-sturvey-1 --nodes=1'
	        conda = params.genomeCondaEnv
		publishDir = 'results'
		cpus = 8
		memory = 64G
	   }
	   withName:INDEXEDBAM {
                process.clusterOptions =  '--account=st-sturvey-1 --nodes=1'
	        conda = params.genomeCondaEnv
		publishDir = 'results'
		cpus = 8
		memory = 64G
	   } 
	   withName:DEEPVARIANT {
                process.clusterOptions =  '--account=st-sturvey-1 --nodes=1'
	        beforeScript = 'module load apptainer'
	        container = params.deepvariantSif 
		publishDir = 'results'
		cpus = 8
		memory = 64G
	    }
	    withName:GLNEXUS2 {
                process.clusterOptions =  '--account=st-sturvey-1 --nodes=1'
	        conda = params.genomeCondaEnv
		publishDir = 'results'
	        cpus = 8
	        memory = 64G
	    }
	    withName:GLNEXUS {
                process.clusterOptions =  '--account=st-sturvey-1 --nodes=1'
	        beforeScript = 'module load apptainer'
	        container = params.glnexusSif     
		publishDir = 'results'
	        cpus = 8
	        memory = 64G
	    }
	    withName:EXOMISER {
                process.clusterOptions =  '--account=st-sturvey-1 --nodes=1'
		publishDir = 'results'
	        cpus = 8
	        memory = 64G
	    }
	    withName:DUPREMOVED {
                process.clusterOptions =  '--account=st-sturvey-1 --nodes=1'
		publishDir = 'results'
	        conda = params.picardCondaEnv
	        cpus = 14 
	        memory = 84G 
	    }
	}
   }
}

conda {
    enabled = true
}
singularity {
    enabled = true
    autoMounts = true
    runOptions = "-e -B '/project/st-sturvey-1/PrecisionHealthVirtualEnvironment/Databases/References/GRCh38/Genome/Ensembl' -B '/project/st-sturvey-1/PrecisionHealthVirtualEnvironment/Software/DeepVariant/deepvariant_1.4.0.sif' -B '/project/st-sturvey-1/PrecisionHealthVirtualEnvironment/Workflows/nextflow_pipeline' -B '/project/st-sturvey-1/PrecisionHealthVirtualEnvironment/Software/GLNexus/glnexus_v1.4.3.sif'"
}

